{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar state_1 = require(\"../state\");\n\nvar FilterBasedAccessor_1 = require(\"./FilterBasedAccessor\");\n\nvar support_1 = require(\"../support\");\n\nvar __1 = require(\"../\");\n\nvar find = require(\"lodash/find\");\n\nvar compact = require(\"lodash/compact\");\n\nvar map = require(\"lodash/map\");\n\nvar filter = require(\"lodash/filter\");\n\nvar omitBy = require(\"lodash/omitBy\");\n\nvar isUndefined = require(\"lodash/isUndefined\");\n\nvar includes = require(\"lodash/includes\");\n\nvar NumericOptionsAccessor =\n/** @class */\nfunction (_super) {\n  __extends(NumericOptionsAccessor, _super);\n\n  function NumericOptionsAccessor(key, options) {\n    var _this = _super.call(this, key) || this;\n\n    _this.state = new state_1.ArrayState();\n    _this.options = options;\n    _this.options.options = support_1.Utils.computeOptionKeys(options.options, [\"from\", \"to\"], \"all\");\n    _this.options.fieldOptions = _this.options.fieldOptions || {\n      type: \"embedded\"\n    };\n    _this.options.fieldOptions.field = _this.options.field;\n    _this.fieldContext = __1.FieldContextFactory(_this.options.fieldOptions);\n    return _this;\n  }\n\n  NumericOptionsAccessor.prototype.getDefaultOption = function () {\n    return find(this.options.options, function (it) {\n      return isUndefined(it.from) && isUndefined(it.to);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOptions = function () {\n    var keys = this.state.getValue();\n    return filter(this.options.options, function (opt) {\n      return includes(keys, opt.key);\n    });\n  };\n\n  NumericOptionsAccessor.prototype.getSelectedOrDefaultOptions = function () {\n    var selectedOptions = this.getSelectedOptions();\n    if (selectedOptions && selectedOptions.length > 0) return selectedOptions;\n    var defaultOption = this.getDefaultOption();\n    if (defaultOption) return [defaultOption];\n    return [];\n  };\n\n  NumericOptionsAccessor.prototype.setOptions = function (titles) {\n    if (titles.length === 1) {\n      this.state = this.state.clear();\n      this.toggleOption(titles[0]);\n    } else {\n      var keys = map(filter(this.options.options, function (opt) {\n        return includes(titles, opt.title);\n      }), \"key\");\n      this.state = this.state.setValue(keys);\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.toggleOption = function (key) {\n    var option = find(this.options.options, {\n      title: key\n    });\n\n    if (option) {\n      if (option === this.getDefaultOption()) {\n        this.state = this.state.clear();\n      } else if (this.options.multiselect) {\n        this.state = this.state.toggle(option.key);\n      } else {\n        this.state = this.state.setValue([option.key]);\n      }\n\n      this.searchkit.performSearch();\n    }\n  };\n\n  NumericOptionsAccessor.prototype.getBuckets = function () {\n    return filter(this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), this.key, \"buckets\"], []), this.emptyOptionsFilter);\n  };\n\n  NumericOptionsAccessor.prototype.getDocCount = function () {\n    return this.getAggregations([this.uuid, this.fieldContext.getAggregationPath(), \"doc_count\"], 0);\n  };\n\n  NumericOptionsAccessor.prototype.emptyOptionsFilter = function (option) {\n    return option.doc_count > 0;\n  };\n\n  NumericOptionsAccessor.prototype.buildSharedQuery = function (query) {\n    var _this = this;\n\n    var filters = this.getSelectedOptions();\n    var filterRanges = map(filters, function (filter) {\n      return _this.fieldContext.wrapFilter(__1.RangeQuery(_this.options.field, {\n        gte: filter.from,\n        lt: filter.to\n      }));\n    });\n    var selectedFilters = map(filters, function (filter) {\n      return {\n        name: _this.translate(_this.options.title),\n        value: _this.translate(filter.title),\n        id: _this.options.id,\n        remove: function remove() {\n          return _this.state = _this.state.remove(filter.key);\n        }\n      };\n    });\n\n    if (filterRanges.length > 0) {\n      query = query.addFilter(this.uuid, __1.BoolShould(filterRanges)).addSelectedFilters(selectedFilters);\n    }\n\n    return query;\n  };\n\n  NumericOptionsAccessor.prototype.getRanges = function () {\n    return compact(map(this.options.options, function (range) {\n      return omitBy({\n        key: range.title,\n        from: range.from,\n        to: range.to\n      }, isUndefined);\n    }));\n  };\n\n  NumericOptionsAccessor.prototype.buildOwnQuery = function (query) {\n    return query.setAggs(__1.FilterBucket.apply(void 0, [this.uuid, query.getFiltersWithoutKeys(this.uuid)].concat(this.fieldContext.wrapAggregations(__1.RangeBucket(this.key, this.options.field, this.getRanges())))));\n  };\n\n  return NumericOptionsAccessor;\n}(FilterBasedAccessor_1.FilterBasedAccessor);\n\nexports.NumericOptionsAccessor = NumericOptionsAccessor;","map":null,"metadata":{},"sourceType":"script"}